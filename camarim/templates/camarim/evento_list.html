{% extends 'base.html' %}
{% block title %}Eventos - InventarioPro{% endblock %}

{% block content %}
<!-- Header da página -->
<div class="page-header">
  <div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <h1><i class='bx bx-calendar-event me-2'></i>Eventos</h1>
        <p class="mb-0">Gerencie todos os seus eventos e suas configurações</p>
      </div>
      <a href="{% url 'camarim:evento_create' %}" class="btn btn-light">
        <i class='bx bx-plus me-1'></i>Novo Evento
      </a>
    </div>
  </div>
</div>

<!-- Barra de busca e filtros -->
<div class="card mb-4">
  <div class="card-body">
    <div class="row align-items-center">
      <div class="col-md-6">
        <div class="input-group">
          <span class="input-group-text">
            <i class='bx bx-search'></i>
          </span>
          <input type="text" class="form-control" id="table-search" placeholder="Buscar eventos...">
        </div>
      </div>
      <div class="col-md-6 text-end">
        <div class="btn-group" role="group">
          <button type="button" class="btn btn-outline-primary active">
            <i class='bx bx-list-ul me-1'></i>Lista
          </button>
          <button type="button" class="btn btn-outline-primary">
            <i class='bx bx-grid-alt me-1'></i>Cards
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Estatísticas rápidas -->
<div class="row mb-4">
  <div class="col-md-3">
    <div class="stats-card">
      <h3 class="stats-number">{{ eventos|length }}</h3>
      <p class="stats-label">Total de Eventos</p>
    </div>
  </div>
  <div class="col-md-3">
    <div class="stats-card">
      <h3 class="stats-number">{{ eventos_ativos|default:0 }}</h3>
      <p class="stats-label">Eventos Ativos</p>
    </div>
  </div>
  <div class="col-md-3">
    <div class="stats-card">
      <h3 class="stats-number">{{ total_salas|default:0 }}</h3>
      <p class="stats-label">Total de Salas</p>
    </div>
  </div>
  <div class="col-md-3">
    <div class="stats-card">
      <h3 class="stats-number">{{ total_propostas|default:0 }}</h3>
      <p class="stats-label">Propostas Geradas</p>
    </div>
  </div>
</div>

<!-- Tabela de eventos -->
<div class="card">
  <div class="card-header">
    <h5 class="mb-0">Lista de Eventos</h5>
  </div>
  <div class="card-body p-0">
    {% if eventos %}
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead>
            <tr>
              <th>Nome do Evento</th>
              <th>Local</th>
              <th>Data Inicial</th>
              <th>Data Final</th>
              <th>Salas</th>
              <th class="text-center">Ações</th>
            </tr>
          </thead>
          <tbody>
            {% for evento in eventos %}
              <tr>
                <td>
                  <div class="d-flex align-items-center">
                    {% if evento.imagem %}
                      <img src="{{ evento.imagem.url }}" alt="{{ evento.nome }}" 
                           class="rounded me-3" style="width: 40px; height: 40px; object-fit: cover;">
                    {% else %}
                      <div class="bg-primary rounded d-flex align-items-center justify-content-center me-3" 
                           style="width: 40px; height: 40px;">
                        <i class='bx bx-calendar-event text-white'></i>
                      </div>
                    {% endif %}
                    <div>
                      <strong>{{ evento.nome }}</strong>
                      {% if evento.descricao %}
                        <br><small class="text-muted">{{ evento.descricao|truncatechars:50 }}</small>
                      {% endif %}
                    </div>
                  </div>
                </td>
                <td>
                  {% if evento.local %}
                    <i class='bx bx-map me-1 text-muted'></i>{{ evento.local }}
                  {% else %}
                    <span class="text-muted">Não informado</span>
                  {% endif %}
                </td>
                <td>
                  {% if evento.data_inicial %}
                    <i class='bx bx-calendar me-1 text-muted'></i>{{ evento.data_inicial|date:"d/m/Y" }}
                  {% else %}
                    <span class="text-muted">Não definida</span>
                  {% endif %}
                </td>
                <td>
                  {% if evento.data_final %}
                    <i class='bx bx-calendar me-1 text-muted'></i>{{ evento.data_final|date:"d/m/Y" }}
                  {% else %}
                    <span class="text-muted">Não definida</span>
                  {% endif %}
                </td>
                <td>
                  <a href="{% url 'camarim:sala_list' evento.id %}" class="btn btn-sm btn-outline-primary">
                    <i class='bx bx-door-open me-1'></i>{{ evento.salas.count }} sala{{ evento.salas.count|pluralize }}
                  </a>
                </td>
                <td class="text-center">
                  <div class="btn-group" role="group">
                    <a href="{% url 'camarim:evento_edit' evento.id %}" 
                       class="btn btn-sm btn-warning" 
                       data-bs-toggle="tooltip" 
                       title="Editar evento">
                      <i class='bx bx-edit'></i>
                    </a>
                    <a href="{% url 'camarim:sala_list' evento.id %}" 
                       class="btn btn-sm btn-info" 
                       data-bs-toggle="tooltip" 
                       title="Gerenciar salas">
                      <i class='bx bx-door-open'></i>
                    </a>
                    <a href="{% url 'camarim:evento_delete' evento.id %}" 
                       class="btn btn-sm btn-danger" 
                       data-bs-toggle="tooltip" 
                       title="Excluir evento">
                      <i class='bx bx-trash'></i>
                    </a>
                  </div>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="text-center py-5">
        <i class='bx bx-calendar-x' style="font-size: 4rem; color: var(--secondary-color);"></i>
        <h4 class="mt-3">Nenhum evento encontrado</h4>
        <p class="text-muted">Comece criando seu primeiro evento para gerenciar o inventário.</p>
        <a href="{% url 'camarim:evento_create' %}" class="btn btn-primary">
          <i class='bx bx-plus me-1'></i>Criar Primeiro Evento
        </a>
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}