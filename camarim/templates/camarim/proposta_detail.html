{% extends 'base.html' %}
{% load static %}
{% block content %}
<h1>{{ proposta.evento.nome }}</h1>
<form method="post">{% csrf_token %}
  <table class="table">
    <thead>
      <tr>
        <th>Sala</th><th>Produto</th><th>Quantidade</th><th>Preço Unit.</th><th>Valor Total</th>
      </tr>
    </thead>
    <tbody>
      {% for form in formset %}
      <tr>
        <td>{{ form.sala }}</td>
        <td>{{ form.produto }}</td>
        <td>{{ form.quantidade }}</td>
        <td>{{ form.preco_unitario }}</td>
        <td>
          {% with item=form.instance %}
            R$ {{ item.total|stringformat:"0.2f" }}
          {% endwith %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
    <tfoot>
      <tr>
        <th colspan="4">Subtotal:</th>
        <th>R$ {{ proposta.subtotal|stringformat:"0.2f" }}</th>
      </tr>
      <tr>
        <th colspan="4">Impostos (%): {{ form.impostos }}</th>
        <th>R$ {{ proposta.total_impostos|stringformat:"0.2f" }}</th>
      </tr>
      <tr>
        <th colspan="4">Total:</th>
        <th>R$ {{ proposta.total|stringformat:"0.2f" }}</th>
      </tr>
    </tfoot>
  </table>
  <button type="submit" class="btn btn-primary">Salvar</button>
  <a href="{% url 'proposta_descritivo' proposta.pk %}" class="btn btn-secondary">Gerar Descritivo</a>
  <a href="?pdf=1" class="btn btn-success">Gerar Proposta (PDF)</a>
</form>

{% if request.GET.pdf %}
  {# aqui você pode chamar sua lib de PDF (weasyprint/xhtml2pdf),
     passar o mesmo contexto e retornar PDF #}
{% endif %}
{% endblock %}